# Version 1.8.0 Development Progress

**Last Updated**: 2025-11-25
**Branch**: 1.8
**Status**: Planning Phase

---

## üìã Planned Features

### Phase 1: Picklist Loader REST API Migration ‚ùå

**Goal**: Migrate Picklist Loader from Metadata API deployment to REST API (similar to Dependency Loader)

**Why This Change?**
- Metadata API deployments are slow and require polling for completion status
- REST API provides immediate updates with instant feedback
- Dependency Loader already uses REST API successfully
- Better user experience with faster operations
- Ability to specify both Label and API Name for each picklist value

**Current Implementation (Metadata API):**
- Uses `metadata-api.js` deploy() method
- Builds ZIP package with CustomObject XML
- Deploys via Metadata API (async operation)
- Polls for deployment status (can take 30+ seconds)
- Limited to API Name only (Label auto-generated from API Name)

**New Implementation (REST API):**
- Use REST API PATCH method on CustomField endpoint
- Direct field updates without deployment packages
- Immediate response (synchronous operation)
- Allow input of both Label and API Name for each value
- Consistent with Dependency Loader approach

**Tasks:**

#### CSV Format Update
- [ ] Update CSV format to include both Label and API Name columns
- [ ] Old format: `Value,Active,Default` (API Name only)
- [ ] New format: `Label,API Name,Active,Default` (both Label and API)
- [ ] Support backward compatibility with old format (Label = API Name if not provided)
- [ ] Update CSV template download
- [ ] Update CSV parsing logic in `picklist-management.js`

#### REST API Integration
- [ ] Research REST API endpoint for picklist value updates
- [ ] Endpoint: `PATCH /services/data/v59.0/tooling/sobjects/CustomField/{FieldId}`
- [ ] Or use: `/services/data/v59.0/sobjects/{Object}/describe` with metadata updates
- [ ] Investigate best approach (Tooling API vs REST API)
- [ ] Create new method in `background/metadata-api.js` or new module
- [ ] Method: `updatePicklistValuesViaREST(session, objectName, fieldName, values)`
- [ ] Handle value structure with both label and apiName properties

#### Value Structure
- [ ] Define new picklist value structure:
```javascript
{
  label: "Small Business",        // Display label
  fullName: "Small_Business",     // API Name (must be unique)
  default: false,                 // Is default value
  isActive: true,                 // Active/Inactive status
  color: null                     // Optional color (standard picklists)
}
```

#### UI Updates
- [ ] Update Picklist Loader preview table to show both Label and API Name columns
- [ ] Add "Label" column before "API Name" column
- [ ] Update preview comparison logic to compare both Label and API Name
- [ ] Show differences in both Label and API Name changes
- [ ] Update "Download Current Values" to include Label column
- [ ] Update CSV template to include Label column

#### Deployment Logic
- [ ] Remove Metadata API deployment code
- [ ] Implement REST API update logic
- [ ] Handle append mode: Keep existing values + add new values
- [ ] Handle overwrite mode: Replace all values with CSV values
- [ ] Validate value uniqueness (API Names must be unique)
- [ ] Handle errors gracefully (duplicate API Names, invalid characters, etc.)
- [ ] Provide instant feedback (no polling required)

#### Testing
- [ ] Test with various CSV formats (with/without Label column)
- [ ] Test append mode with Label + API Name
- [ ] Test overwrite mode with Label + API Name
- [ ] Test backward compatibility (old CSV format without Label)
- [ ] Test error handling (duplicate API Names, special characters)
- [ ] Test with standard and custom objects
- [ ] Test with namespaced fields

**Technical Notes:**
- REST API approach requires different field structure than Metadata API
- Need to map between Salesforce field describe format and update format
- Investigate if Tooling API CustomField PATCH supports picklist value updates
- May need to use composite REST API for bulk value updates
- Consider transaction safety (all values update or none)

**Files to Modify:**
- `pages/picklist-management/picklist-management.js` - Update UI and CSV parsing
- `pages/picklist-management/picklist-management.html` - Update preview table columns
- `pages/picklist-management/picklist-management.css` - Style new columns
- `background/metadata-api.js` - Add REST API update method (or create new module)
- `background/service-worker.js` - Update message handlers if needed

**Status**: ‚ùå Not Started

**Phase Status**: ‚ùå Not Done

---

### Phase 2: Delta-Based Metadata Deployment (Carried from v1.7) ‚ùå

**Goal**: Deploy only the differences (delta) between source and target metadata

**Security**: This feature will be password-protected like Dependency Loader

**Tasks:**

#### API Module
- [ ] Create `background/delta-deployment-api.js`
- [ ] Add `calculateDelta()` - Compare source vs target metadata
- [ ] Add `buildDeltaPackage()` - Generate deployment package with only changes
- [ ] Add `validateDelta()` - Pre-deployment validation
- [ ] Add `deployDelta()` - Execute delta deployment via Metadata API
- [ ] Add `previewDelta()` - Show what will be deployed

#### UI Implementation
- [ ] Create `pages/delta-deploy/` directory
- [ ] Add `delta-deploy.html` - Main UI
- [ ] Add `delta-deploy.js` - UI logic with password protection
- [ ] Add `delta-deploy.css` - Styling with dark mode

#### Integration
- [ ] Update `background/service-worker.js` with message handlers
- [ ] Integrate with deployment history logging
- [ ] Update `popup/index.html` - Add "Delta Deployment" button with lock icon
- [ ] Implement password protection (unlock key: TBD)

#### Features
- [ ] Compare metadata between source and target orgs
- [ ] Calculate delta (additions, modifications, deletions)
- [ ] Preview changes before deployment
- [ ] Support multiple metadata types:
  - [ ] Permissions (Profiles, Permission Sets)
  - [ ] Fields (Custom Fields)
  - [ ] Validation Rules
  - [ ] Flows
  - [ ] Picklists
  - [ ] Dependencies
- [ ] Delta deployment package generation
- [ ] Deploy only changed components
- [ ] Deployment validation and error handling
- [ ] Integration with Deployment History
- [ ] Rollback capability
- [ ] Password protection with experimental feature warning
- [ ] Full dark mode support

**Delta Calculation Logic:**
- **Additions**: Components in source but not in target
- **Modifications**: Components in both but with different values
- **Deletions**: Components in target but not in source (handle carefully)

**Deployment Strategy:**
- Generate minimal package.xml with only changed components
- Build deployment ZIP with delta metadata only
- Use Metadata API deploy() with checkOnly=true for validation
- Execute actual deployment after user confirmation
- Log all deployments to Deployment History

**Technical Approach:**
- Use existing Org Compare API as foundation
- Extend comparison logic to generate deployment packages
- Reuse Metadata API integration from existing features
- Implement JSON/XML diff algorithm for metadata comparison
- Use JSZip for package generation

**Status**: ‚ùå Not Started

**Phase Status**: ‚ùå Not Done

---

### Phase 3: Documentation & Release ‚ùå

**Goal**: Finalize documentation and prepare for v1.8.0 release

**Tasks:**

#### Documentation
- [ ] Update `CHANGELOG.md` with all v1.8.0 changes
- [ ] Update `README.md` with new features
- [ ] Update `CLAUDE.md` if needed

#### Version Management
- [ ] Update `manifest.json` to version 1.8.0

#### Testing
- [ ] Test all features in Lightning and Classic
- [ ] Test with different Salesforce editions
- [ ] Test with large datasets
- [ ] Cross-browser testing (Chrome, Edge)
- [ ] Test dark mode across all pages
- [ ] Test new REST API picklist updates
- [ ] Test backward compatibility with old CSV format

#### Release
- [ ] Create git tag v1.8.0
- [ ] Push to GitHub
- [ ] Create GitHub release with notes
- [ ] Verify extension loads correctly

**Status**: ‚ùå Not Started

**Phase Status**: ‚ùå Not Done

---

## üìä Overall Progress

**Total Phases**: 3
**Completed**: 0
**In Progress**: 0
**Not Started**: 3

**Overall Status**: 0% Complete

---

## üîÑ Version History

- **v1.7.0** (2025-11-25): UI Improvements, Org Compare Enhancements, Deployment Tracking, Picklist Consolidation
- **v1.6.0** (2025-11-21): Enhanced Comparisons, Monitoring & Field Analytics
- **v1.5.0** (2025-11-20): Advanced Administration & Security Features
- **v1.4.0** (2025-11-18): Enhanced Features & Shortcuts
- **v1.3.0** (2025-11-18): Pop-up UI Redesign - Dot Compliance Brand Alignment
- **v1.2.0** (2025-11-18): Progressive DOT Health Check
- **v1.1.0** (2025-11-15): Picklist Loader, Dependency Loader, DOT Health Check
- **v1.0.0** (2024-11-13): Initial Release

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Export Fields - DOT Toolkit</title>
  <!-- Google Fonts: Quicksand (Headlines) and PT Serif (Body) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@500;700&family=PT+Serif:wght@400;700&display=swap" rel="stylesheet">
  <!-- Material Design Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet">
  <link rel="stylesheet" href="../../popup/design-tokens.css">
  <link rel="stylesheet" href="export-fields.css">
</head>
<body>
  <div class="container">
    <header class="page-header">
      <div class="header-content">
        <h1>
          <span class="material-symbols-rounded">table_chart</span>
          Export Fields
        </h1>
        <div class="header-actions">
          <button id="refreshBtn" class="btn btn-icon" title="Refresh">
            <span class="material-symbols-rounded">refresh</span>
          </button>
          <button id="settingsBtn" class="btn btn-icon" title="Settings">
            <span class="material-symbols-rounded">settings</span>
          </button>
        </div>
      </div>
      <div class="org-info">
        <strong>Org:</strong> <span id="orgUrl">Loading...</span>
      </div>
    </header>

    <!-- Settings Panel (hidden by default) -->
    <div id="settingsPanel" class="settings-panel hidden">
      <h3>Export Settings</h3>
      <div class="setting-item">
        <label for="defaultExportFormat">Default export format:</label>
        <select id="defaultExportFormat">
          <option value="csv" selected>CSV</option>
          <option value="json">JSON</option>
        </select>
      </div>
      <div class="setting-item">
        <label>
          <input type="checkbox" id="includeToolingMetadata">
          Include additional metadata (Description, Created/Modified dates)
        </label>
        <div class="setting-help">
          Fetches extra metadata from Tooling API. May take longer for large objects.
        </div>
      </div>
      <button id="closeSettingsBtn" class="btn btn-secondary">Close</button>
    </div>

    <!-- Object Selection Section -->
    <div class="selection-section">
      <div class="section-header">
        <h2>
          <span class="material-symbols-rounded">category</span>
          Select Objects
        </h2>
      </div>

      <div class="object-search-container">
        <div class="search-box">
          <span class="material-symbols-rounded search-icon">search</span>
          <input type="text" id="objectSearch" placeholder="Search objects...">
        </div>
        <div class="object-actions">
          <button id="selectAllObjectsBtn" class="btn btn-secondary btn-sm">Select All</button>
          <button id="clearObjectsBtn" class="btn btn-secondary btn-sm">Clear</button>
        </div>
      </div>

      <div class="object-list-container">
        <div id="objectListLoading" class="loading-message">
          <span class="material-symbols-rounded spinning">sync</span>
          Loading objects...
        </div>
        <div id="objectList" class="object-list hidden">
          <!-- Objects will be populated here -->
        </div>
      </div>

      <div class="selection-info">
        <span id="selectedObjectCount">0</span> objects selected
      </div>
    </div>

    <!-- Filter Section -->
    <div class="filter-section">
      <div class="section-header">
        <h2>
          <span class="material-symbols-rounded">filter_alt</span>
          Filter Fields
        </h2>
      </div>

      <div class="filter-groups">
        <!-- Field Type Filter -->
        <div class="filter-group">
          <label class="filter-label">Field Types:</label>
          <div class="checkbox-grid" id="fieldTypeFilters">
            <label class="checkbox-label">
              <input type="checkbox" value="Text" checked>
              <span>Text</span>
            </label>
            <label class="checkbox-label">
              <input type="checkbox" value="Number" checked>
              <span>Number</span>
            </label>
            <label class="checkbox-label">
              <input type="checkbox" value="Date" checked>
              <span>Date/Time</span>
            </label>
            <label class="checkbox-label">
              <input type="checkbox" value="Picklist" checked>
              <span>Picklist</span>
            </label>
            <label class="checkbox-label">
              <input type="checkbox" value="Lookup" checked>
              <span>Lookup</span>
            </label>
            <label class="checkbox-label">
              <input type="checkbox" value="Checkbox" checked>
              <span>Checkbox</span>
            </label>
            <label class="checkbox-label">
              <input type="checkbox" value="Id" checked>
              <span>ID</span>
            </label>
            <label class="checkbox-label">
              <input type="checkbox" value="Other" checked>
              <span>Other</span>
            </label>
          </div>
          <div class="filter-actions">
            <button id="selectAllTypesBtn" class="btn btn-text btn-sm">Select All</button>
            <button id="clearTypesBtn" class="btn btn-text btn-sm">Clear All</button>
          </div>
        </div>

        <!-- Custom/Standard Filter -->
        <div class="filter-group">
          <label class="filter-label">Field Category:</label>
          <div class="radio-group">
            <label class="radio-label">
              <input type="radio" name="fieldCategory" value="all" checked>
              <span>All Fields</span>
            </label>
            <label class="radio-label">
              <input type="radio" name="fieldCategory" value="custom">
              <span>Custom Only</span>
            </label>
            <label class="radio-label">
              <input type="radio" name="fieldCategory" value="standard">
              <span>Standard Only</span>
            </label>
          </div>
        </div>
      </div>
    </div>

    <!-- Load Fields Button -->
    <div class="action-section">
      <button id="loadFieldsBtn" class="btn btn-primary btn-lg" disabled>
        <span class="material-symbols-rounded">download</span>
        Load Fields
      </button>
    </div>

    <!-- Progress Section (hidden by default) -->
    <div id="progressSection" class="progress-section hidden">
      <div class="progress-header">
        <span class="material-symbols-rounded spinning">sync</span>
        <span id="progressText">Loading fields...</span>
      </div>
      <div class="progress-bar-container">
        <div id="progressBar" class="progress-bar" style="width: 0%"></div>
      </div>
      <div class="progress-details">
        <span id="progressDetails">0 of 0 objects</span>
      </div>
    </div>

    <!-- Results Section (hidden by default) -->
    <div id="resultsSection" class="results-section hidden">
      <!-- Summary Stats -->
      <div class="summary-section">
        <div class="stat-card">
          <span class="material-symbols-rounded stat-icon total">table_chart</span>
          <div class="stat-content">
            <span class="stat-value" id="totalFieldsCount">-</span>
            <span class="stat-label">Total Fields</span>
          </div>
        </div>
        <div class="stat-card">
          <span class="material-symbols-rounded stat-icon custom">add_circle</span>
          <div class="stat-content">
            <span class="stat-value" id="customFieldsCount">-</span>
            <span class="stat-label">Custom</span>
          </div>
        </div>
        <div class="stat-card">
          <span class="material-symbols-rounded stat-icon standard">verified</span>
          <div class="stat-content">
            <span class="stat-value" id="standardFieldsCount">-</span>
            <span class="stat-label">Standard</span>
          </div>
        </div>
        <div class="stat-card">
          <span class="material-symbols-rounded stat-icon required">asterisk</span>
          <div class="stat-content">
            <span class="stat-value" id="requiredFieldsCount">-</span>
            <span class="stat-label">Required</span>
          </div>
        </div>
      </div>

      <!-- Usage Analytics Button -->
      <div class="usage-analytics-section">
        <button id="loadUsageBtn" class="btn btn-secondary" disabled>
          <span class="material-symbols-rounded">analytics</span>
          Load Usage Data
        </button>
        <div id="usageProgress" class="usage-progress hidden">
          <div class="progress-bar">
            <div class="progress-fill" id="usageProgressFill"></div>
          </div>
          <span id="usageProgressText">Analyzing field usage...</span>
        </div>
      </div>

      <!-- Preview Header -->
      <div class="preview-header">
        <h2>
          <span class="material-symbols-rounded">preview</span>
          Field Preview
        </h2>
        <div class="preview-actions">
          <div class="search-box search-box-sm">
            <span class="material-symbols-rounded search-icon">search</span>
            <input type="text" id="fieldSearch" placeholder="Search fields...">
          </div>
          <button id="selectAllFieldsBtn" class="btn btn-secondary btn-sm">Select All</button>
          <button id="clearFieldsBtn" class="btn btn-secondary btn-sm">Clear</button>
        </div>
      </div>

      <!-- Field Selection Info -->
      <div class="field-selection-info">
        <span id="selectedFieldCount">0</span> of <span id="displayedFieldCount">0</span> fields selected for export
      </div>

      <!-- Preview Table -->
      <div class="table-container">
        <table id="fieldsTable" class="fields-table">
          <thead>
            <tr>
              <th class="col-checkbox">
                <input type="checkbox" id="selectAllFieldsCheckbox" title="Select all visible fields">
              </th>
              <th class="col-object sortable" data-sort="objectName">
                Object
                <span class="material-symbols-rounded sort-icon">unfold_more</span>
              </th>
              <th class="col-label sortable" data-sort="label">
                Label
                <span class="material-symbols-rounded sort-icon">unfold_more</span>
              </th>
              <th class="col-apiname sortable" data-sort="apiName">
                API Name
                <span class="material-symbols-rounded sort-icon">unfold_more</span>
              </th>
              <th class="col-type sortable" data-sort="type">
                Type
                <span class="material-symbols-rounded sort-icon">unfold_more</span>
              </th>
              <th class="col-required sortable" data-sort="required">
                Required
                <span class="material-symbols-rounded sort-icon">unfold_more</span>
              </th>
              <th class="col-custom sortable" data-sort="custom">
                Custom
                <span class="material-symbols-rounded sort-icon">unfold_more</span>
              </th>
              <th class="col-usage sortable" data-sort="usage">
                Usage
                <span class="material-symbols-rounded sort-icon">unfold_more</span>
              </th>
            </tr>
          </thead>
          <tbody id="fieldsTableBody">
            <!-- Fields will be populated here -->
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      <div class="pagination">
        <button id="prevPageBtn" class="btn btn-secondary btn-sm" disabled>
          <span class="material-symbols-rounded">chevron_left</span>
          Previous
        </button>
        <span id="pageInfo">Page 1 of 1</span>
        <button id="nextPageBtn" class="btn btn-secondary btn-sm" disabled>
          Next
          <span class="material-symbols-rounded">chevron_right</span>
        </button>
      </div>

      <!-- Export Actions -->
      <div class="export-section">
        <div class="export-options">
          <label class="filter-label">Export Format:</label>
          <div class="radio-group">
            <label class="radio-label">
              <input type="radio" name="exportFormat" value="csv" checked>
              <span>CSV</span>
            </label>
            <label class="radio-label">
              <input type="radio" name="exportFormat" value="json">
              <span>JSON</span>
            </label>
          </div>
        </div>
        <button id="exportBtn" class="btn btn-primary btn-lg" disabled>
          <span class="material-symbols-rounded">download</span>
          Export Selected Fields
        </button>
      </div>
    </div>

    <!-- Empty State -->
    <div id="emptyState" class="empty-state hidden">
      <span class="material-symbols-rounded">table_chart</span>
      <p>No fields found matching your criteria</p>
    </div>
  </div>

  <script type="module" src="export-fields.js"></script>
</body>
</html>

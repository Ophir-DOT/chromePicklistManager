# Version 2.0.0 Development Progress

**Created**: 2025-12-23
**Branch**: 2.0
**Status**: Planning Phase

---

## Carried Over from v1.8.0

The following items were planned for v1.8.0 but not completed:

---

### 1. Delta-Based Metadata Deployment (High Priority)

**Goal**: Deploy only the differences (delta) between source and target metadata

**Security**: Password-protected feature (like Dependency Loader)

**Status**: Not Started

**Tasks:**

#### API Module
- [ ] Create `background/delta-deployment-api.js`
- [ ] Add `calculateDelta()` - Compare source vs target metadata
- [ ] Add `buildDeltaPackage()` - Generate deployment package with only changes
- [ ] Add `validateDelta()` - Pre-deployment validation
- [ ] Add `deployDelta()` - Execute delta deployment via Metadata API
- [ ] Add `previewDelta()` - Show what will be deployed

#### UI Implementation
- [ ] Create `pages/delta-deploy/` directory
- [ ] Add `delta-deploy.html` - Main UI
- [ ] Add `delta-deploy.js` - UI logic with password protection
- [ ] Add `delta-deploy.css` - Styling with dark mode

#### Integration
- [ ] Update `background/service-worker.js` with message handlers
- [ ] Integrate with deployment history logging
- [ ] Update `popup/index.html` - Add "Delta Deployment" button with lock icon
- [ ] Implement password protection

#### Features
- [ ] Compare metadata between source and target orgs
- [ ] Calculate delta (additions, modifications, deletions)
- [ ] Preview changes before deployment
- [ ] Support multiple metadata types:
  - [ ] Permissions (Profiles, Permission Sets)
  - [ ] Fields (Custom Fields)
  - [ ] Validation Rules
  - [ ] Flows
  - [ ] Picklists
  - [ ] Dependencies
- [ ] Delta deployment package generation
- [ ] Deploy only changed components
- [ ] Deployment validation and error handling
- [ ] Integration with Deployment History
- [ ] Rollback capability
- [ ] Full dark mode support

**Technical Approach:**
- Use existing Org Compare API as foundation
- Extend comparison logic to generate deployment packages
- Reuse Metadata API integration from existing features
- Implement JSON/XML diff algorithm for metadata comparison
- Use JSZip for package generation

---

### 2. Record Migrator Testing & Completion

**Goal**: Complete testing and polish the Record Migrator tool

**Status**: Core Implementation Complete - Testing Pending

**Remaining Tasks:**

#### Testing
- [ ] Test with Label,API Name CSV format
- [ ] Test append mode with Label + API Name
- [ ] Test error handling (duplicate API Names, special characters)
- [ ] Test with standard and custom objects
- [ ] Test with namespaced fields
- [ ] Test with large datasets (100+ records)
- [ ] Test parent-child relationship migration
- [ ] Test State ID remapping
- [ ] Test External ID field mapping
- [ ] Test rollback functionality

#### UI Polish
- [ ] Source org selection refinement
- [ ] Target org authentication improvements
- [ ] Better error messages and user feedback
- [ ] Progress tracking enhancements

---

### 3. CHANGELOG.md Update for v1.8.0

**Status**: Not Done (released without changelog entry)

**Tasks:**
- [ ] Add v1.8.0 section to CHANGELOG.md with:
  - Record Migrator Tool
  - Approval Process Check
  - Validation Rule Links
  - Enhanced Dependency Export
  - Picklist Loader REST API migration

---

## Security & Performance Improvements (from Audit)

The following items were identified in the security audit (doc/status/SUMMARY.md):

### Critical Security Fixes

- [ ] **XSS Vulnerability Fix**: Apply `escapeHtml()` to all innerHTML assignments
  - Files: `popup/app.js`, `pages/deployment-history/deployment-history.js`, all UI pages
  - ~30+ instances of innerHTML that need sanitization

- [ ] **Add Content Security Policy**: Add CSP to manifest.json
  ```json
  "content_security_policy": {
    "extension_pages": "script-src 'self'; object-src 'self'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com;"
  }
  ```

- [ ] **Remove Session ID Logging**: Remove/redact session IDs from console.log
  - Files: `background/session-manager.js`, `background/api-client.js`

- [ ] **SOQL Injection Prevention**: Implement `escapeSoql()` function
  - Files: `background/health-check-api.js`, `background/tooling-api.js`
  - Create shared utility in `shared/utils.js`

### High Priority Improvements

- [ ] **Replace setInterval with chrome.alarms**: Fix update-checker.js
  - Add `"alarms"` permission to manifest.json
  - Use `chrome.alarms.create()` instead of `setInterval()`

- [ ] **Add Request Timeouts**: Add timeout to all fetch calls
  - Use `AbortSignal.timeout(30000)` for all API calls
  - File: `background/metadata-api.js`

- [ ] **Implement Batched API Calls**: Fix popup UI blocking
  - Process API calls in batches of 5 concurrent requests
  - File: `popup/app.js` export operations

- [ ] **Consolidate Host Permissions**: Reduce permission scope
  - Remove redundant domains (*.lightning.force.com covered by *.force.com)
  - Remove *.salesforce.mil unless needed

### Medium Priority Improvements

- [ ] **Add Global Error Handlers**: Catch unhandled promise rejections
- [ ] **Implement Retry Logic**: Add exponential backoff for failed API calls
- [ ] **Add Rate Limiting**: Prevent hitting Salesforce API limits
- [ ] **Monitor Storage Quota**: Check chrome.storage quota usage
- [ ] **Add Message Timeout Wrapper**: Prevent hanging promises

### Low Priority Improvements

- [ ] **Remove Console Logs**: Create debug flag system for production
- [ ] **Host Google Fonts Locally**: Download fonts, remove CDN dependency
- [ ] **Implement Automated Tests**: Playwright E2E tests
- [ ] **Add Telemetry**: Optional error reporting with user consent

---

## New Features for v2.0

### 1. Profile/Permission Set Import

**Goal**: Import permission exports from another environment

**Tasks:**
- [ ] Map profiles/permission sets between source and target environments
- [ ] Preview permission changes before deployment
- [ ] Selective import (choose which permissions to apply)
- [ ] Bulk permission updates for specific fields

### 2. Validation Rule Manager Enhancements

**Goal**: Comprehensive validation rule management

**Tasks:**
- [ ] Disable/enable validation rules in bulk (useful during migrations)
- [ ] Test validation rules against sample data
- [ ] Clone validation rules to other objects

### 3. Console Log Cleanup

**Goal**: Remove all console.log statements for production release

**Status**: ~150+ console.log statements identified across codebase

**Files with most statements:**
- `background/record-migrator-api.js` (~50)
- `background/service-worker.js` (~25)
- `background/session-manager.js` (~20)
- `popup/app.js` (~75)
- `pages/picklist-management/picklist-management.js` (~40)
- `pages/record-migrator/record-migrator.js` (~10)

**Approach Options:**
1. Remove all console.log statements
2. Create debug mode with toggle in settings
3. Replace with conditional logging utility

---

## Version History Reference

- **v1.8.0** (2025-12-23): Record Migrator, Approval Process Check, Validation Rule Links
- **v1.7.0** (2025-11-25): UI Improvements, Org Compare Enhancements, Deployment Tracking
- **v1.6.0** (2025-11-21): Enhanced Comparisons, Monitoring & Field Analytics
- **v1.5.0** (2025-11-20): Advanced Administration & Security Features
- **v1.4.0** (2025-11-18): Enhanced Features & Shortcuts
- **v1.3.0** (2025-11-18): Pop-up UI Redesign
- **v1.2.0** (2025-11-18): Progressive DOT Health Check
- **v1.1.0** (2025-11-15): Picklist Loader, Dependency Loader, DOT Health Check
- **v1.0.0** (2024-11-13): Initial Release

---

## Priority Order for v2.0

1. **Critical Security Fixes** (XSS, CSP, SOQL injection, session logging)
2. **High Priority Improvements** (alarms, timeouts, batching)
3. **Delta-Based Metadata Deployment** (major new feature)
4. **Record Migrator Testing** (complete v1.8 feature)
5. **Console Log Cleanup** (production readiness)
6. **Medium/Low Priority Improvements** (as time permits)

---

**Last Updated**: 2025-12-23
